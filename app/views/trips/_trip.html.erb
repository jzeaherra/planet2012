<style type="text/css">
  #map_canvas {   float:right;  width:400px;  height:300px;  }
</style>

<div id="visit">
<div id="map_canvas"></div>
  <table> 
   <%  trip.visits.order(:hour).each do |visit| %>
    <tr class="<%= cycle('list_line_odd', 'list_line_even') %>"> 
      <td> 
        <%= link_to image_tag(visit.site.image.url, :class => 'list_image'), visit.site %>
      </td> 
 
      <td class="list_description"> 
        <dl> 
          <dt><%= visit.hour.to_s + 'h: ' %>
              <%=link_to(visit.site.name, visit.site) %></dt> 
          <dd><%= truncate(strip_tags(visit.site.description),
                 :length => 80) %></dd>
        </dl> 
      </td>
 
      <td class="list_actions"> 
        <%= link_to 'Show', visit.site %><br/>
        <%= link_to 'Destroy', visit, 
                    :confirm => 'Are you sure?',
                    :method => :delete if trip.user == current_user  %>

      </td> 
    </tr> 
   <% end %>
  </table> 

</div>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">

    var mylat = 40;
    var mylong = -3;

    var latlng = new google.maps.LatLng(mylat, mylong);

    var myOptions = {
      zoom: 1,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

  var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

   <%  trip.visits.order(:hour).each do |visit| %>

	<% next unless visit.site.lat %>
    var mylat = <%= visit.site.lat %>;
    var mylong = <%= visit.site.long %>;

    var latlng = new google.maps.LatLng( mylat , mylong );

      var marker = new google.maps.Marker({
          position: latlng, 
           map: map, 
          title: "<%= visit.site.name %>"
      });

   <% end %>


</script>

